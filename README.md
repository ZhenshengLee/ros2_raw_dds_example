# ROS 2 Raw DDS example

This repository contains an example of having a "raw" DDS node communicate with a ROS 2 network.
In this case "raw" means that it is a program that does not use any of the ROS 2 libraries, but instead uses a DDS implementation directly.
In this particular case, the DDS implementation used is [Fast-DDS](https://github.com/eProsima/Fast-DDS/).

## Building from source

### Build the prerequisites

1. `$ git clone https://github.com/eProsima/Fast-CDR -b v1.0.19`
1. `$ mkdir -p Fast-CDR/build`
1. `$ pushd Fast-CDR/build`
1. `$ cmake -DCMAKE_INSTALL_PREFIX=../../install ..`
1. `$ make -j10 install`
1. `$ popd`
1. `$ git clone https://github.com/eProsima/foonathan_memory_vendor`
1. `$ mkdir -p foonathan_memory_vendor/build`
1. `$ pushd foonathan_memory_vendor/build`
1. `$ cmake -DCMAKE_INSTALL_PREFIX=../../install ..`
1. `$ make -j10 install`
1. `$ popd`
1. `$ git clone https://github.com/eProsima/Fast-DDS -b 2.1.x`
1. `$ mkdir -p Fast-DDS/build`
1. `$ pushd Fast-DDS/build`
1. `$ cmake -DCOMPILE_TOOLS=OFF -DCMAKE_INSTALL_PREFIX=../../install ..`
1. `$ make -j10 install`
1. `$ popd`

### Build the example code

1. `$ mkdir -p build`
1. `$ pushd build`
1. `$ cmake .. -DCMAKE_INSTALL_PREFIX=../install ..`
1. `$ make -j10`
1. `$ popd`

## Running

There are two binaries generated by this example: `ros2_fastrtps_send` and `ros2_fastrtps_recv`.

`ros2_fastrtps_send` publishes a ROS 2 [UUID message](https://github.com/ros2/unique_identifier_msgs/blob/80c21658a1b17f0c4e24002552f2426db236985f/msg/UUID.msg) on the `/uuid_topic` once a second, incrementing the first number every publication.

`ros2_fastrtps_recv` listens to the `/uuid_topic`, and prints every time it gets a new UUID message.

### Demo 1 - Publisher from raw DDS into ROS 2 network

This demo requires 3 terminals.

#### Terminal 1

```
$ ./ros2_fastrtps_send
```

#### Terminal 2

```
$ ./ros2_fastrtps_recv
```

#### Terminal 3

```
$ . /opt/ros/rolling/setup.bash
$ RMW_IMPLEMENTATION=rmw_fastrtps_cpp ros2 topic list -t
$ RMW_IMPLEMENTATION=rmw_fastrtps_cpp ros2 topic echo /uuid_topic unique_identifier_msgs/msg/UUID
```

You should see the data being published from Terminal 1 into both Terminal 2 and Terminal 3.

### Demo 2 - Publisher from ROS 2 network into raw DDS

This demo requires 2 terminals.

#### Terminal 1

```
$ . /opt/ros/rolling/setup.bash
$ RMW_IMPLEMENTATION=rmw_fastrtps_cpp ros2 topic pub /uuid_topic unique_identifier_msgs/msg/UUID "uuid:
- 0
- 0
- 0
- 0
- 0
- 0
- 0
- 0
- 0
- 0
- 0
- 0
- 0
- 0
- 0
- 0"
```

#### Terminal 2

```
$ ./ros2_fastrtps_recv
```

You should see the data being published from Terminal 1 into Terminal 2.
